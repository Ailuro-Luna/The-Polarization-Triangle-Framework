# 极化三角框架关键参数Sobol敏感性分析方案

## 1. 研究背景与目标

### 1.1 研究动机

极化三角框架中，四个关键参数（α、β、γ、cohesion_factor）的设置直接影响Agent观点动态的演化模式。理解这些参数的相对重要性和交互效应对于：
- 模型参数校准和优化
- 理论机制验证
- 实际应用中的参数敏感性评估
- 模型稳健性分析

具有重要意义。

### 1.2 研究目标

通过Sobol敏感性分析实现以下目标：

1. **量化参数重要性**：确定每个参数对模型输出的相对贡献度
2. **识别交互效应**：分析参数间的协同和拮抗作用
3. **参数优先级排序**：为参数调优提供指导
4. **模型行为理解**：深化对极化三角框架机制的认识

## 2. Sobol敏感性分析理论基础

### 2.1 基本原理

Sobol敏感性分析基于方差分解，将模型输出的总方差分解为各输入参数及其交互项的贡献：

```
Var(Y) = Σᵢ Vᵢ + Σᵢ<ⱼ Vᵢⱼ + Σᵢ<ⱼ<ₖ Vᵢⱼₖ + ... + V₁₂...ₚ
```

其中：
- Y为模型输出
- Vᵢ为参数xᵢ的主效应方差
- Vᵢⱼ为参数xᵢ和xⱼ的交互效应方差

### 2.2 敏感性指数

**一阶敏感性指数（First-order indices, Sᵢ）**：
```
Sᵢ = Vᵢ / Var(Y)
```
表示参数xᵢ单独对输出方差的贡献比例。

**总敏感性指数（Total-effect indices, STᵢ）**：
```
STᵢ = 1 - V₋ᵢ / Var(Y)
```
表示参数xᵢ及其所有交互项对输出方差的总贡献比例。

### 2.3 交互效应分析

**二阶交互效应**：
```
Sᵢⱼ = Vᵢⱼ / Var(Y)
```

**交互效应强度判断**：
- STᵢ - Sᵢ ≈ 0：参数xᵢ主要通过主效应影响输出
- STᵢ - Sᵢ > 0：参数xᵢ存在显著交互效应

## 3. 参数设置与取值范围

### 3.1 目标参数定义

| 参数 | 符号 | 默认值 | 作用机制 | 预期影响 |
|------|------|--------|----------|----------|
| 自我激活系数 | α | 0.4 | 控制Agent观点坚持强度 | 高值促进极化 |
| 社会影响系数 | β | 0.12 | 控制邻居影响强度 | 高值促进收敛 |
| 道德化影响系数 | γ | 1.0 | 调节道德化抑制效应 | 高值增强抵抗 |
| 身份凝聚力因子 | cohesion_factor | 0.2 | 增强网络连接强度 | 高值促进传播 |

### 3.2 参数取值范围确定

基于文献调研、专家知识和预实验结果，确定各参数的合理取值范围：

```python
parameter_ranges = {
    'alpha': [0.1, 0.8],        # 自我激活系数
    'beta': [0.05, 0.3],        # 社会影响系数
    'gamma': [0.2, 2.0],        # 道德化影响系数
    'cohesion_factor': [0.0, 0.5]  # 身份凝聚力因子
}
```

**取值范围选择依据：**
- **α范围 [0.1, 0.8]**：低于0.1时自我激活过弱，高于0.8时过度固执
- **β范围 [0.05, 0.3]**：低于0.05时社会影响微弱，高于0.3时过度从众
- **γ范围 [0.2, 2.0]**：涵盖道德化影响从微弱到强烈的完整区间
- **cohesion_factor范围 [0.0, 0.5]**：从无额外凝聚力到强凝聚力

## 4. 输出指标选择

### 4.1 主要输出指标

选择能够全面反映模型行为的关键指标：

#### 4.1.1 极化相关指标
- **Koudenburg极化指数**：量化系统整体极化程度
- **意见方差**：反映观点分散程度
- **极端观点比例**：|opinion| > 0.8的Agent比例

#### 4.1.2 收敛相关指标
- **平均绝对意见**：系统观点强度
- **收敛时间**：达到稳态所需步数
- **最终稳定性**：最后10%步数内的方差系数

#### 4.1.3 动态过程指标
- **意见轨迹长度**：观点变化的累积距离
- **振荡频率**：观点方向改变的频次
- **群体分化度**：不同身份群体间的意见差异

### 4.2 指标计算方法

```python
def calculate_output_metrics(simulation):
    """计算敏感性分析的输出指标"""
    metrics = {}
    
    # 极化指标
    metrics['polarization_index'] = simulation.calculate_polarization_index()
    metrics['opinion_variance'] = np.var(simulation.opinions)
    metrics['extreme_ratio'] = np.mean(np.abs(simulation.opinions) > 0.8)
    
    # 收敛指标
    metrics['mean_abs_opinion'] = np.mean(np.abs(simulation.opinions))
    metrics['convergence_time'] = calculate_convergence_time(simulation)
    metrics['final_stability'] = calculate_stability(simulation)
    
    # 动态指标
    metrics['trajectory_length'] = calculate_trajectory_length(simulation)
    metrics['oscillation_freq'] = calculate_oscillation_frequency(simulation)
    metrics['group_divergence'] = calculate_group_divergence(simulation)
    
    return metrics
```

## 5. 实验设计方案

### 5.1 样本生成策略

**采用Saltelli采样方案**：
- 对于4个参数，需要生成 N × (2D + 2) = N × 10 个样本
- 其中N为基础样本数，D=4为参数个数
- 推荐N ≥ 1000，总样本数至少10,000

**采样代码框架**：
```python
from SALib.sample import saltelli
from SALib.analyze import sobol

# 定义参数空间
problem = {
    'num_vars': 4,
    'names': ['alpha', 'beta', 'gamma', 'cohesion_factor'],
    'bounds': [[0.1, 0.8], [0.05, 0.3], [0.2, 2.0], [0.0, 0.5]]
}

# 生成Saltelli样本
param_values = saltelli.sample(problem, N=1000)
```

### 5.2 模拟实验配置

**基础配置设置**：
```python
base_config = {
    'num_agents': 200,           # 足够大的Agent数量确保统计稳定性
    'network_type': 'lfr',       # 使用LFR网络确保社区结构
    'network_params': {
        'tau1': 3, 'tau2': 1.5, 'mu': 0.1,
        'average_degree': 5, 'min_community': 10
    },
    'opinion_distribution': 'twin_peak',  # 双峰分布增加极化可能性
    'morality_rate': 0.5,        # 中等道德化率
    'num_steps': 200,            # 足够的步数确保收敛
    'num_runs': 5                # 多次运行取平均值降低随机性
}
```

**实验流程**：
1. 固定随机种子确保可重复性
2. 每个参数组合运行多次独立模拟
3. 计算各次运行结果的平均值作为该参数组合的输出
4. 记录所有输出指标用于敏感性分析

### 5.3 计算资源估算

**计算复杂度分析**：
- 样本数：10,000个参数组合
- 每组合运行次数：5次
- 每次运行步数：200步
- 总模拟次数：10,000 × 5 = 50,000次
- 每次模拟时间：约2-5秒（取决于硬件）
- 总计算时间：约28-70小时

**优化策略**：
- 并行计算：利用多核CPU并行处理不同参数组合
- 分批执行：将大任务分解为小批次，便于监控和错误恢复
- 结果缓存：保存中间结果，支持断点续算

## 6. 实现计划

### 6.1 代码架构设计

**模块结构**：
```
polarization_triangle/
├── sensitivity/
│   ├── __init__.py
│   ├── sobol_analysis.py      # 主要分析框架
│   ├── parameter_sampler.py   # 参数采样
│   ├── experiment_runner.py   # 实验执行
│   ├── metrics_calculator.py  # 指标计算
│   └── visualizer.py         # 结果可视化
└── scripts/
    └── run_sobol_analysis.py  # 主执行脚本
```

### 6.2 核心代码实现

**主分析框架**：
```python
class SobolAnalyzer:
    def __init__(self, problem_definition, base_config):
        self.problem = problem_definition
        self.base_config = base_config
        self.results = {}
    
    def run_analysis(self, n_samples=1000, n_runs=5):
        """执行完整的Sobol敏感性分析"""
        # 1. 生成参数样本
        param_samples = self.generate_samples(n_samples)
        
        # 2. 运行模拟实验
        simulation_results = self.run_simulations(param_samples, n_runs)
        
        # 3. 计算敏感性指数
        sensitivity_indices = self.calculate_sensitivity(simulation_results)
        
        # 4. 结果可视化和报告
        self.generate_report(sensitivity_indices)
        
        return sensitivity_indices
```

### 6.3 开发里程碑

**第一阶段（1-2周）：基础框架搭建**
- 实现参数采样模块
- 搭建实验运行框架
- 开发指标计算功能
- 创建简单的可视化工具

**第二阶段（2-3周）：核心分析实现**
- 集成SALib库进行Sobol分析
- 实现并行计算支持
- 开发结果缓存和恢复机制
- 完善错误处理和日志记录

**第三阶段（1-2周）：结果分析与可视化**
- 开发高级可视化功能
- 实现统计显著性检验
- 生成详细分析报告
- 文档撰写和代码优化

## 7. 结果分析框架

### 7.1 敏感性指数解释

**重要性分类标准**：
- **高敏感性**：Sᵢ > 0.1 或 STᵢ > 0.15
- **中等敏感性**：0.05 < Sᵢ ≤ 0.1 或 0.1 < STᵢ ≤ 0.15  
- **低敏感性**：Sᵢ ≤ 0.05 或 STᵢ ≤ 0.1

**交互效应分析**：
- **强交互效应**：STᵢ - Sᵢ > 0.1
- **中等交互效应**：0.05 < STᵢ - Sᵢ ≤ 0.1
- **弱交互效应**：STᵢ - Sᵢ ≤ 0.05

### 7.2 可视化方案

**主要图表类型**：

1. **敏感性指数条形图**：展示各参数的一阶和总敏感性指数
2. **热力图**：显示不同输出指标对各参数的敏感性模式
3. **交互效应网络图**：可视化参数间的交互关系强度
4. **参数重要性排序图**：按敏感性大小排列参数重要性
5. **收敛诊断图**：验证Sobol估计的收敛性和稳定性

**代码示例**：
```python
def plot_sensitivity_results(si_results, output_names):
    """绘制敏感性分析结果"""
    fig, axes = plt.subplots(2, 2, figsize=(15, 12))
    
    # 一阶敏感性指数
    plot_first_order_indices(si_results, axes[0,0])
    
    # 总敏感性指数
    plot_total_indices(si_results, axes[0,1])
    
    # 敏感性热力图
    plot_sensitivity_heatmap(si_results, output_names, axes[1,0])
    
    # 交互效应分析
    plot_interaction_effects(si_results, axes[1,1])
    
    plt.tight_layout()
    plt.savefig('sobol_sensitivity_results.png', dpi=300, bbox_inches='tight')
```

### 7.3 统计显著性检验

**Bootstrap置信区间**：
- 对每个敏感性指数计算95%置信区间
- 识别统计显著的敏感性（置信区间不包含0）
- 比较不同参数敏感性的显著性差异

**收敛性检验**：
- 监控敏感性指数随样本数增加的变化
- 评估估计精度和稳定性
- 确定所需的最小样本数

## 8. 预期结果与假设

### 8.1 预期发现

基于极化三角框架的理论机制，预期发现：

**参数重要性排序**（假设）：
1. **α (自我激活系数)**：预期对极化相关指标具有最高敏感性
2. **β (社会影响系数)**：预期对收敛相关指标具有较高敏感性
3. **γ (道德化影响系数)**：预期在中高道德化率情况下影响显著
4. **cohesion_factor**：预期作为调节因子，主要通过交互效应发挥作用

**关键交互效应**（假设）：
- **α × β**：自我激活与社会影响的竞争关系
- **β × γ**：社会影响与道德化抑制的交互作用
- **γ × cohesion_factor**：道德化与网络凝聚力的协同效应

### 8.2 不同输出指标的敏感性模式

**极化指标**：
- 预期α具有最高敏感性（促进极化）
- β可能表现为负敏感性（抑制极化）
- γ与cohesion_factor通过交互效应影响极化

**收敛指标**：
- β预期具有最高敏感性（促进收敛）
- α可能表现为负敏感性（阻碍收敛）
- cohesion_factor作为促进收敛的辅助因子

## 9. 质量保证与验证

### 9.1 数值验证

**解析验证**：
- 对简化情况进行解析计算验证
- 检查极端参数值下的模型行为
- 验证敏感性计算的数学正确性

**对比验证**：
- 与其他敏感性分析方法（如Morris方法）结果对比
- 与单因素敏感性分析结果比较
- 与文献中类似模型的敏感性结果比较

### 9.2 稳健性检验

**参数范围测试**：
- 测试不同参数范围设置对结果的影响
- 评估边界效应和非线性区域的敏感性
- 验证结果对参数范围选择的稳健性

**基础配置测试**：
- 在不同网络类型下重复分析
- 测试不同Agent数量和模拟步数的影响
- 评估随机性对敏感性估计的影响

### 9.3 结果可重现性

**版本控制**：
- 记录所有代码版本和参数设置
- 固定随机种子确保结果可重现
- 详细记录实验环境和依赖库版本

**文档记录**：
- 详细记录实验过程和参数选择依据
- 保存所有中间结果和原始数据
- 提供完整的复现指南

## 10. 项目时间表与资源配置

### 10.1 详细时间表

**准备阶段（1周）**：
- 文献调研和方法学习
- 参数范围确定和验证
- 实验设计细化

**开发阶段（4-5周）**：
- Week 1-2: 基础框架搭建
- Week 3-4: 核心分析实现
- Week 5: 结果分析与可视化

**执行阶段（1-2周）**：
- 大规模计算执行
- 结果验证和质量检查
- 初步分析和解释

**总结阶段（1周）**：
- 深度结果分析
- 报告撰写和文档整理
- 代码优化和封装

### 10.2 资源需求

**计算资源**：
- 多核CPU服务器（推荐16核以上）
- 充足内存（推荐32GB以上）
- 大容量存储空间（至少100GB）

**软件依赖**：
- Python 3.8+
- SALib库（敏感性分析）
- NumPy, SciPy（数值计算）
- Matplotlib, Seaborn（可视化）
- Pandas（数据处理）
- Joblib（并行计算）

**人力投入**：
- 主要研究人员：6-8周全职投入
- 代码审查：1-2周兼职协助
- 结果讨论：定期团队会议

## 11. 风险评估与应对策略

### 11.1 主要风险

**计算复杂性风险**：
- 风险：计算时间超出预期，资源不足
- 应对：分批执行，优化算法，申请更多计算资源

**数值稳定性风险**：
- 风险：某些参数组合导致模拟不稳定或不收敛
- 应对：增加数值检查，排除异常结果，调整参数范围

**结果解释风险**：
- 风险：敏感性结果与理论预期不符，难以解释
- 应对：深入机制分析，增加定性验证，寻求专家意见

### 11.2 质量控制措施

**过程监控**：
- 实时监控计算进度和中间结果
- 定期检查数值异常和错误
- 及时发现和处理问题

**结果验证**：
- 多方法交叉验证
- 独立重复实验
- 专家评审和同行审议

## 12. 预期成果与应用价值

### 12.1 学术贡献

**方法学贡献**：
- 为Agent-Based模型敏感性分析提供标准化流程
- 发展多指标综合敏感性分析方法
- 建立极化动力学模型的参数重要性理论

**实证发现**：
- 揭示极化三角框架中关键参数的相对重要性
- 发现参数间复杂交互效应的作用机制
- 为模型参数校准和优化提供定量依据

### 12.2 实际应用

**模型改进**：
- 指导参数简化和模型约简
- 优化计算效率和预测精度
- 增强模型的稳健性和可靠性

**政策设计**：
- 识别影响社会极化的关键因素
- 为干预策略设计提供参数重要性排序
- 评估不同政策措施的潜在效果

### 12.3 技术成果

**软件工具**：
- 开发通用的ABM敏感性分析工具包
- 创建可视化和报告生成系统
- 建立标准化的实验流程和模板

**数据资源**：
- 构建大规模参数-输出数据库
- 提供基准测试数据集
- 建立结果比较和验证标准

## 13. 总结

本方案为极化三角框架关键参数的Sobol敏感性分析提供了完整的理论基础、实验设计和实施计划。通过系统性的敏感性分析，将深入理解α、β、γ、cohesion_factor四个参数在模型中的作用机制和相对重要性，为极化三角框架的理论发展和实际应用提供重要支撑。

该分析不仅具有重要的学术价值，还将为相关领域的模型开发、参数校准和政策设计提供有价值的参考和指导。通过严格的质量控制和全面的验证，确保分析结果的可靠性和实用性。 